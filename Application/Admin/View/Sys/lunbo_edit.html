<include file="Common/head"/>
<link rel="stylesheet" type="text/css" href="__CSS__/plugins/webuploader/webuploader.css">
<link rel="stylesheet" type="text/css" href="__CSS__/demo/webuploader-demo-single.css">
<script>
        var $path='{:U("Sys/upload")}';
        var $js='__JS__/';
</script>
<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">

        <!-- Panel Other -->
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>修改轮播图</h5>
                <div class="ibox-tools">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-wrench"></i>
                    </a>
                    <a class="close-link">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
            </div>
            <div class="ibox-content">
                <form action="{:U('Sys/lunbo_save')}" method="post" class="form-horizontal" id="signupForm">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">名称</label>
                        <div class="col-sm-8">
                            <input type="text" name="name" class="form-control" value="{$data[name]}">
                            <input type="hidden" name="id" value="{$data[id]}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">排序</label>
                        <div class="col-sm-8">
                            <input type="text" name="sort" class="form-control" value="{$data[sort]}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">链接</label>
                        <div class="col-sm-8">
                            <input type="text" name="url" class="form-control" value="{$data[url]}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">轮播原图</label>
                        <div class="col-sm-8">
                            <p class="imgWrap"><img src="{$data[sm_img]}"></p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">上传新图</label>
                        <div class="col-sm-8">

                            <div id="uploader-demo" class="web-uploader">
                                <div class="queueList" style="margin: 0px;">
                                    <div id="dndArea" class="placeholder">
                                        <div id="singlefilePicker" ></div>
                                    </div>
                                </div>
                                <div class="statusBar" style="display:none;">
                                    <div class="progress">
                                        <span class="text">0%</span>
                                        <span class="percentage"></span>
                                    </div>
                                    <div class="info"></div>
                                    <div class="btns">
                                        <div id="singlefilePicker2"></div>
                                        <div class="uploadBtn">开始上传</div>
                                    </div>
                                </div>
                                <input type="hidden" id="image" name="img" value="{$data[img]}">
                                <input type="hidden" name="oldimg" value="{$data[img]}">
                            </div>
                        </div>

                    </div>

                    <div class="form-group">
                        <div class="col-sm-4 col-sm-offset-2">
                            <button class="btn btn-primary" type="submit" disabled="disabled">提交</button>
                            <a href="{:U('Sys/lunbo_list')}" class="btn btn-white">取消</a>
                        </div>
                    </div>
                </form>

            </div>
        </div>
        <!-- End Panel Other -->
    </div>
    <script src="__JS__/bootstrap.min.js?v=3.3.6"></script>
    <script src="__JS__/jquery.min.js?v=2.1.4"></script>
    <script type="text/javascript">
        var BASE_URL = '__JS__/plugins/webuploader/index.html';
    </script>
    <script src="__JS__/plugins/webuploader/webuploader.min.js"></script>
    <script src="__JS__/demo/webuploader-demo-single.js"></script>

    <!-- 表单验证 -->
    <script src="__JS__/plugins/validate/jquery.validate.min.js"></script>
    <script src="__JS__/plugins/validate/messages_zh.min.js"></script>
    <script>

        $().ready(function(){
            var slidername = '{$data[name]}';
            var sort = '{$data[sort]}';
            var url = '{$data[url]}';

            var e = "<i class='fa fa-times-circle'></i> ";
            var validator = $("#signupForm").validate({
                ignore: [],
                rules: {
                    name: "required",
                    sort: "number",
                    sort: {
                        required: true,
                        number: true
                    },
                    url: "required",
                    img: "required"
                },
                messages: {
                    name: e + "请输入轮播名称",
                    sort: {
                        required: e + "请输入排序",
                        number: e + "请输入1-9有效的数字"
                    },
                    url: e + "请输入链接地址",
                    img: e + "请上传图片"
                }
            });

            //验证输入框是否有修改
            $('input').blur(function(){
                if ($("input[name=name]").val()!=slidername || $("input[name=sort]").val()!=sort || $("input[name=url]").val()!=url|| $("#image").val()!=$("input[name=oldimg]").val()) {
                    $("button[type=submit]").removeAttr("disabled");
                } else {
                    $("button[type=submit]").attr("disabled",true);
                }
            });
            $("#image").change(function(){
                //验证单个元件是否成功
                 validator.element(this);
                 $("button[type=submit]").removeAttr("disabled");
            });
        });
    </script>
</body>
</html>
